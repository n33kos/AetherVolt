!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AetherVolt",[],t):"object"==typeof exports?exports.AetherVolt=t():e.AetherVolt=t()}(window,function(){return function(n){var i={};function a(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}return a.m=n,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=13)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.x=e,this.y=t}return i(n,[{key:"toArray",value:function(){return[this.x,this.y]}}]),n}();t.default=a},function(e,t,n){"use strict";var o=n(18),s=n(19);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||o)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var r=0;r<16;++r)t[i+r]=a[r];return t||s(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=r(n(3)),v=r(n(0));function r(e){return e&&e.__esModule?e:{default:e}}var o=function(e){function d(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,e)),n=e.animations,i=e.currentFrame,a=void 0===i?0:i,r=e.currentAnimation,o=void 0===r?null:r,s=e.mirrorX,u=void 0!==s&&s,l=e.mirrorY,c=void 0!==l&&l,h=e.scale,f=void 0===h?new v.default(1,1):h;return t.animations=n,t.currentAnimation=o,t.currentFrame=a,t.scale=f,t.mirrorX=u,t.mirrorY=c,t.lastAnimation=null,t.tickCounter=0,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,a.default),i(d,[{key:"load",value:function(){var n=this;Object.keys(this.animations).forEach(function(e){var t=new Image;t.src=n.animations[e].spriteSheet,n.animations[e].image=t})}},{key:"calculateOffset",value:function(){this.scale&&(this.absoluteOffset=new v.default(-this.offset.x*this.dimensions.x*this.scale.x*(this.mirrorX?-1:1),-this.offset.y*this.dimensions.y*this.scale.y*(this.mirrorY?-1:1)))}},{key:"draw",value:function(){this.animations[this.currentAnimation]&&(this.handleFrames(),(this.mirrorX||this.mirrorY)&&this.GameState.Canvas.ctx.scale(this.mirrorX?-1:1,this.mirrorY?-1:1),this.GameState.Canvas.ctx.drawImage(this.animations[this.currentAnimation].image,this.currentFrame*this.dimensions.x,0,this.dimensions.x,this.dimensions.y,0,0,this.dimensions.x*this.scale.x,this.dimensions.y*this.scale.y))}},{key:"handleFrames",value:function(){this.tickCounter++,this.animations[this.currentAnimation].loop&&(this.incrementAnimationFrame(),this.currentFrame>=this.animations[this.currentAnimation].frames&&(this.currentFrame=0)),this.animations[this.currentAnimation].loop||(this.currentFrame>=this.animations[this.currentAnimation].frames-1?(this.tickCounter=0,this.currentFrame=this.animations[this.currentAnimation].frames-1):this.incrementAnimationFrame()),this.lastAnimation!==this.currentAnimation&&(this.lastAnimation=this.currentAnimation,this.currentFrame=0,this.tickCounter=0)}},{key:"incrementAnimationFrame",value:function(){this.tickCounter>this.animations[this.currentAnimation].ticksPerFrame&&(this.tickCounter=0,this.currentFrame+=1)}}]),d}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=o(n(10)),d=o(n(0)),r=o(n(26));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e)),n=e.dimensions,i=void 0===n?new d.default(100,100):n,a=e.offset,r=void 0===a?new d.default(.5,.5):a,o=e.position,s=void 0===o?new d.default:o,u=e.rotation,l=void 0===u?0:u,c=e.alpha,h=void 0===c?1:c;return t.absoluteOffset=new d.default,t.audioNodes=[],t.canvasPosition=new d.default,t.controlCallbackIds=[],t.dimensions=i,t.GameState=GameState,t.offset=r,t.position=s,t.rotation=l,t.isVisible=!0,t.alpha=h,t.turbulenceSpeed=.05,t.turbulence=new d.default(0,0),t.turbulenceRange=new d.default(1,15),t.turbulenceStep=Math.random()*Math.PI*2,t.setPosition(s),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,a.default),i(f,[{key:"setPosition",value:function(e){this.position=e,this.canvasPosition=(0,r.default)(this.GameState,this.position),this.calculateOffset()}},{key:"calculateOffset",value:function(){this.absoluteOffset=new d.default(-this.offset.x*this.dimensions.x,-this.offset.y*this.dimensions.y)}},{key:"drawEntity",value:function(){this.isVisible&&(this.GameState.Canvas.ctx.translate(this.canvasPosition.x,this.canvasPosition.y),this.GameState.Canvas.ctx.rotate(this.rotation%(2*Math.PI)),this.GameState.Canvas.ctx.translate(this.absoluteOffset.x,this.absoluteOffset.y),this.GameState.Canvas.ctx.globalAlpha=this.alpha,this.draw(),this.GameState.Canvas.ctx.setTransform(1,0,0,1,0,0),this.GameState.Canvas.ctx.globalAlpha=1)}},{key:"update",value:function(){}},{key:"draw",value:function(){}},{key:"handleTurbulence",value:function(){if(this.targetPosition){this.addTurbulence();var e=new d.default(this.targetPosition.x-this.canvasPosition.x-this.turbulence.x,this.targetPosition.y-this.canvasPosition.y-this.turbulence.y);this.canvasPosition=new d.default(this.canvasPosition.x+.005*e.x*this.GameState.deltaTime,this.canvasPosition.y+.005*e.y*this.GameState.deltaTime),this.calculateOffset()}}},{key:"addTurbulence",value:function(){this.turbulenceStep+=this.turbulenceSpeed,this.turbulenceStep>=2*Math.PI&&(this.turbulenceStep=0),this.turbulence=new d.default(Math.cos(this.turbulenceStep)*this.turbulenceRange.x,Math.sin(this.turbulenceStep)*this.turbulenceRange.y)}}]),f}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(i):void 0},r=o(n(2)),p=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function y(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,e)),n=e.x,i=e.y,a=e.id,r=e.type,o=e.player,s=e.isInHand,u=void 0!==s&&s,l=e.dragPosition,c=void 0===l?null:l,h=e.targetPosition,f=void 0===h?null:h,d=e.outline,v=void 0===d?null:d;return t.x=n,t.y=i,t.id=a,t.tileType=r,t.player=o,t.isInHand=u,t.dragPosition=c,t.targetRotation=0,t.targetPosition=f,t.canvasPosition=f,t.outline=v,t.animations={exist:{frames:1,spriteSheet:"./img/Pipes_Empty.png",ticksPerFrame:5,loop:!1}},t.currentAnimation="exist",t.neighborPattern=[],t.isHovered=!1,t.placedBy=!1,t.turbulenceSpeed=.02,t.turbulenceRange=new p.default(5,5),t.setType(r),t.calculateOffset(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(y,r.default),i(y,[{key:"setType",value:function(e){this.tileType=e,this.animations.exist.spriteSheet=e.spriteSheet,this.neighborPattern=e.neighborPattern,this.load()}},{key:"init",value:function(e){this.grid=e,this.neighbors=this.getNeighbors()}},{key:"getNeighbors",value:function(){var t=this,e=[];return this.grid?(this.neighborPattern.includes(0)&&e.push(this.grid.find(function(e){return e.id==t.x+1+"_"+t.y})),this.neighborPattern.includes(1)&&e.push(this.grid.find(function(e){return e.id==t.x+"_"+(t.y+1)})),this.neighborPattern.includes(2)&&e.push(this.grid.find(function(e){return e.id==t.x-1+"_"+t.y})),this.neighborPattern.includes(3)&&e.push(this.grid.find(function(e){return e.id==t.x+"_"+(t.y-1)})),e):[]}},{key:"rotateCell",value:function(t){var e=this.targetRotation+Math.PI/2*t;this.targetRotation=e,this.neighborPattern=this.neighborPattern.map(function(e){return(e+=t)<0&&(e=3),3<e&&(e=0),e}),this.neighbors=this.getNeighbors()}},{key:"handleRotation",value:function(){var e=this.targetRotation-this.rotation;this.rotation+=.01*e*this.GameState.deltaTime}},{key:"drawEntity",value:function(){this.outline&&(this.outline.canvasPosition=this.targetPosition,this.outline.calculateOffset(),this.setOutlineColor(),this.outline.drawEntity()),a(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"drawEntity",this).call(this)}},{key:"draw",value:function(){this.isInHand||this.handleTurbulence(),this.handleRotation(),a(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"draw",this).call(this)}},{key:"setOutlineColor",value:function(){this.GameState.Canvas.ctx.strokeStyle="rgba(0, 0, 0, 0.05)","PLAYER_COLUMN"===this.tileType.type&&(this.GameState.Canvas.ctx.strokeStyle="rgba(0, 0, 0, 0)"),this.placedBy&&(this.GameState.Canvas.ctx.strokeStyle="rgb("+this.placedBy.color+", 0.5"),this.isHovered&&this.GameState.currentLevel.tileHelper.isDragging&&(this.GameState.Canvas.ctx.strokeStyle="rgba("+this.GameState.currentLevel.attackingPlayer.color+", 0.6)")}}]),y}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=this.getTypeId(e),this.type=this.getTypeString(this.id)}return i(t,[{key:"getTypeId",value:function(e){return{MOVE:1,PLACE:2,ROTATE:3}[e]}},{key:"getTypeString",value:function(e){return{1:"MOVE",2:"PLACE",3:"ROTATE"}[e]}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return t.x<=e.x&&e.x<=t.x+n.x&&t.y<=e.y&&e.y<=t.y+n.y}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=this.getTypeId(e),this.type=this.getTypeString(this.id),this.spriteSheet=this.getSpriteSheet(this.id),this.neighborPattern=this.getNeighborPattern(this.id)}return i(t,[{key:"getTypeId",value:function(e){return{EMPTY:1,PLAYER_COLUMN:2,STRAIGHT:3,BEND:4,TRIPLE:5,QUAD:6}[e]}},{key:"getTypeString",value:function(e){return{1:"EMPTY",2:"PLAYER_COLUMN",3:"STRAIGHT",4:"BEND",5:"TRIPLE",6:"QUAD"}[e]}},{key:"getSpriteSheet",value:function(e){return{1:"./img/Brass_Empty.png",2:"./img/Brass_Empty.png",3:"./img/Brass_Straight.png",4:"./img/Brass_Bend.png",5:"./img/Brass_Triple.png",6:"./img/Brass_Quad.png"}[e]}},{key:"getNeighborPattern",value:function(e){return{1:[],2:[0,1,2,3],3:[1,3],4:[0,1],5:[0,1,3],6:[0,1,2,3]}[e]}}]),t}();t.default=a},function(e,t,n){"use strict";function i(a,r,o,s){var u,l=0;return"boolean"!=typeof r&&(s=o,o=r,r=void 0),function(){var e=this,t=Number(new Date)-l,n=arguments;function i(){l=Number(new Date),o.apply(e,n)}s&&!u&&i(),u&&clearTimeout(u),void 0===s&&a<t?i():!0!==r&&(u=setTimeout(s?function(){u=void 0}:i,void 0===s?a-t:a))}}Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=i,t.debounce=function(e,t,n){return void 0===n?i(e,t,!1):i(e,n,!1!==t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=n(10),o=(i=r)&&i.__esModule?i:{default:i};var s=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.name="Default Level",t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,o.default),a(n,[{key:"gameLogic",value:function(){}}]),n}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function n(e){var t=e.GameState;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.GameState=t,this.audioNodes=[],this.controlCallbackIds=[]}return i(n,[{key:"load",value:function(){}},{key:"unload",value:function(){var t=this;this.audioNodes.forEach(function(e){e.stop(0)}),this.audioNodes=[],this.controlCallbackIds.forEach(function(e){t.GameState.Controls.removeCallback(e)}),this.controlCallbackIds=[]}},{key:"addControlsCallback",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;this.controlCallbackIds.push(this.GameState.Controls.addCallback(e,t,n))}},{key:"addAudioNode",value:function(e){this.audioNodes.push(e),e.load()}}]),n}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=s(n(6)),r=s(n(2)),o=s(n(0));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e)),n=e.animations,i=void 0===n?null:n,a=e.callback,r=void 0===a?function(){}:a,o=e.mouseDownSprite,s=void 0===o?"":o,u=e.mouseUpSprite,l=void 0===u?"":u,c=e.order,h=void 0===c?-10:c;return t.callback=r,(t.animations=i)||(t.animations={mouseDown:{frames:1,loop:!1,spriteSheet:s,ticksPerFrame:10},mouseUp:{frames:1,loop:!1,spriteSheet:l,ticksPerFrame:10}}),t.currentAnimation="mouseUp",t.addControlsCallback("mouseDown",t.handleMouseDown.bind(t),h),t.addControlsCallback("mouseUp",t.handleMouseUp.bind(t),h),t.addControlsCallback("touchStart",t.handleMouseDown.bind(t),h),t.addControlsCallback("touchEnd",t.handleMouseUp.bind(t),h),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,r.default),i(f,[{key:"isPositionInButton",value:function(e){return(0,a.default)(e,new o.default(this.canvasPosition.x+this.absoluteOffset.x*(this.mirrorX?-1:1),this.canvasPosition.y+this.absoluteOffset.y*(this.mirrorY?-1:1)),new o.default(this.dimensions.x*this.scale.x,this.dimensions.y*this.scale.y))}},{key:"handleMouseDown",value:function(e){if(this.isPositionInButton(this.GameState.Controls.position))return this.currentAnimation="mouseDown",!(this.currentFrame=0)}},{key:"handleMouseUp",value:function(){if(this.currentAnimation="mouseUp",this.currentFrame=0,this.isPositionInButton(this.GameState.Controls.position))return this.callback(),!0}}]),f}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Math.random()*(t-e)+e}},function(e,t,n){"use strict";var i=h(n(14)),a=h(n(15)),r=h(n(16)),o=h(n(20)),s=h(n(39)),u=h(n(40)),l=h(n(41)),c=h(n(42));function h(e){return e&&e.__esModule?e:{default:e}}var f={Audio:i.default,Canvas:a.default,Controls:r.default,GameState:o.default,Render:s.default,Scene:u.default,UI:l.default,Update:c.default};document.addEventListener("DOMContentLoaded",function(e){var t=new f.GameState;t.init(),(window.GameState=t).Audio=new f.Audio(t),t.Canvas=new f.Canvas(t),t.Canvas.init(),t.Controls=new f.Controls(t),t.Controls.init(),t.Scene=new f.Scene(t),t.Scene.init(),t.Render=new f.Render(t),t.Render.init(),t.Update=new f.Update(t),t.Update.init(),t.UI=new f.UI(t),t.UI.init()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.audioContext=null,this.masterAudioNode=null,this.isInitialized=!1}return i(t,[{key:"init",value:function(){var e=new(window.AudioContext||window.webkitAudioContext),t=(this.audioContext=e).createGain();t.gain.value=.75,t.connect(e.destination),this.masterAudioNode=t,this.isInitialized=!0}},{key:"toggleMute",value:function(){"running"===this.audioContext.state?this.audioContext.suspend():"suspended"===this.audioContext.state&&this.audioContext.resume()}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=n(8);var r=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.cx=null,this.cy=null,this.canvas=null,this.ctx=null,this.scale=1}return i(t,[{key:"init",value:function(){this.setDimensions(),this.initCanvas()}},{key:"setDimensions",value:function(){this.scale=window.devicePixelRatio,this.width=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)*this.scale,this.height=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)*this.scale}},{key:"initCanvas",value:function(){var e=this,t=document.querySelector("canvas");t.width=this.width,t.height=this.height,this.cx=this.width/2,this.cy=this.height/2;var n=(this.canvas=t).getContext("2d");this.ctx=n,this.resizeCanvas(),window.addEventListener("resize",(0,a.throttle)(500,function(){e.setDimensions(),e.resizeCanvas()}))}},{key:"resizeCanvas",value:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.cx=this.width/2,this.cy=this.height/2,this.ctx.imageSmoothingEnabled=!1}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}}]),t}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=n(8),r=u(n(17)),o=u(n(1)),s=u(n(0));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.isMouseDown=!1,this.lastPosition=null,this.position=null,this.pressedKeys=[],this.debounceValue=10,this.callbacks=r.default.callbacks}return i(t,[{key:"addCallback",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=(0,o.default)();return this.callbacks[e].push({callBack:t,order:n,uuid:i}),this.sortCallbacks(),i}},{key:"sortCallbacks",value:function(){var t=this;Object.keys(this.callbacks).forEach(function(e){t.callbacks[e].sort(function(e,t){return e.order-t.order})})}},{key:"clearCallbacks",value:function(){this.callbacks=r.default.callbacks}},{key:"removeCallback",value:function(t){var n=this;Object.keys(this.callbacks).forEach(function(e){n.callbacks[e]=n.callbacks[e].filter(function(e){return e.uuid!==t})})}},{key:"init",value:function(){var t=this;document.addEventListener("mousemove",(0,a.throttle)(this.debounceValue,function(e){return t.handleMouseMove(e)})),document.addEventListener("mousedown",function(e){return t.handleMouseDown(e)}),document.addEventListener("mouseup",function(e){return t.handleMouseUp(e)}),document.addEventListener("touchmove",(0,a.throttle)(this.debounceValue,function(e){return t.handleTouchMove(e)})),document.addEventListener("touchstart",function(e){return t.handleTouchStart(e)}),document.addEventListener("touchend",function(e){return t.handleTouchEnd(e)}),document.onkeydown=this.handleKeyDown.bind(this),document.onkeyup=this.handleKeyUp.bind(this)}},{key:"handleTouchStart",value:function(e){this.lastPosition=this.position;var t=this.isMouseDown=!0,n=!1,i=void 0;try{for(var a,r=this.callbacks.touchStart[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){if(a.value.callBack(e))break}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"handleTouchEnd",value:function(e){this.lastPosition=this.position;var t=!(this.isMouseDown=!1),n=!1,i=void 0;try{for(var a,r=this.callbacks.touchEnd[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){if(a.value.callBack(e))break}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"handleTouchMove",value:function(e){e.preventDefault(),this.setPosition(e);var t=!0,n=!1,i=void 0;try{for(var a,r=this.callbacks.touchMove[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){if(a.value.callBack(e))break}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"handleMouseDown",value:function(e){this.lastPosition=this.position;var t=this.isMouseDown=!0,n=!1,i=void 0;try{for(var a,r=this.callbacks.mouseDown[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){if(a.value.callBack(e))break}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"handleMouseUp",value:function(e){this.lastPosition=this.position;var t=!(this.isMouseDown=!1),n=!1,i=void 0;try{for(var a,r=this.callbacks.mouseUp[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){if(a.value.callBack(e))break}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"handleMouseMove",value:function(e){this.setPosition(e);var t=!0,n=!1,i=void 0;try{for(var a,r=this.callbacks.mouseMove[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){if(a.value.callBack(e))break}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"handleKeyDown",value:function(e){this.pressedKeys.includes(e.keyCode)||this.pressedKeys.push(e.keyCode);var t=!0,n=!1,i=void 0;try{for(var a,r=this.callbacks.keyDown[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){if(a.value.callBack(e))break}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"handleKeyUp",value:function(e){var t=this.pressedKeys.indexOf(e.keyCode);-1<t&&this.pressedKeys.splice(t,1);var n=!0,i=!1,a=void 0;try{for(var r,o=this.callbacks.keyUp[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){if(r.value.callBack(e))break}}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}}},{key:"setPosition",value:function(e){"clientX"in e&&(this.position=new s.default(e.clientX*this.GameState.Canvas.scale,e.clientY*this.GameState.Canvas.scale)),"targetTouches"in e&&(this.position=new s.default(e.targetTouches[0].clientX*this.GameState.Canvas.scale,e.targetTouches[0].clientY*this.GameState.Canvas.scale))}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={callbacks:{mouseDown:[],mouseUp:[],mouseMove:[],touchStart:[],touchEnd:[],touchMove:[],keyDown:[],keyUp:[]}}},function(e,t,n){"use strict";var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var a=new Uint8Array(16);e.exports=function(){return i(a),a}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},function(e,t,n){"use strict";for(var a=[],i=0;i<256;++i)a[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=a;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=s(n(21)),r=s(n(9)),o=s(n(22));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.deltaTime=a.default.deltaTime,this.isPaused=a.default.isPaused,this.level=a.default.level,this.levels=a.default.levels,this.score=a.default.score,this.playerName=a.default.playerName,this.currentLevel=new r.default({GameState:this})}return i(e,[{key:"init",value:function(){this.initLevels()}},{key:"initLevels",value:function(){var t=this;this.levels=o.default.map(function(e){return new e({GameState:t})})}},{key:"loadLevel",value:function(){var e=this.levels[this.level];e.load(),this.currentLevel=e,document.activeElement.blur()}},{key:"play",value:function(){this.isPaused=!1,this.loadLevel()}},{key:"restart",value:function(){this.endlevel(),this.play()}},{key:"quit",value:function(){this.endlevel(),this.UI.setScreen("mainmenu")}},{key:"togglePause",value:function(){this.isPaused=!this.isPaused,this.isPaused&&this.Audio.audioContext.resume(),this.isPaused||this.Audio.audioContext.suspend()}},{key:"endlevel",value:function(){this.currentLevel.unload(),this.isPaused=!0,this.score=a.default.score}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={deltaTime:1,isPaused:!0,level:0,levels:[],playerName:"Player 1",score:0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(23),r=(i=a)&&i.__esModule?i:{default:i};t.default=[r.default]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=i(n(24)),o=(i(n(5)),i(n(25))),s=i(n(27)),u=i(n(28)),l=i(n(29)),c=i(n(30)),h=i(n(32)),f=i(n(9)),d=i(n(33)),v=i(n(34)),y=i(n(36)),p=(i(n(12)),i(n(4)),i(n(37))),m=(i(n(7)),i(n(1))),b=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e)),n=e.GameState;return t.name="Prototype Level",t.rows=6,t.columns=8,t.currentPlayerTurn=0,t.selectedTile=null,t.currentAction=null,t.tileHelper=new p.default(n),t.attackingPlayer=null,t.defendingPlayer=null,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,f.default),a(i,[{key:"load",value:function(){var a=this;this.GameState.Scene.clear();var e=new s.default({GameState:this.GameState,dimensions:new b.default(128,256),offset:new b.default(0,0),scale:new b.default(this.GameState.Canvas.width/128,this.GameState.Canvas.height/128)});e.canvasPosition=new b.default(0,-this.GameState.Canvas.height),this.GameState.Scene.add(e),this.deck=new l.default({deckSize:this.rows*this.columns}),this.players=[new y.default({GameState:this.GameState,name:"Player 1",uuid:(0,m.default)(),color:"0,0,255",avatar:new o.default({GameState:this.GameState,dimensions:new b.default(64,128),scale:new b.default(this.GameState.Canvas.width/460,this.GameState.Canvas.width/460),offset:new b.default(.5,.5),callback:this.clickAvatar.bind(this,"Player 1"),mouseDownSprite:"./img/Ship.png",mouseUpSprite:"./img/Ship.png",targetPosition:new b.default(-256,this.GameState.Canvas.cy),animations:{mouseDown:{frames:12,loop:!0,spriteSheet:"./img/Ship.png",ticksPerFrame:5},mouseUp:{frames:12,loop:!0,spriteSheet:"./img/Ship.png",ticksPerFrame:5},damage:{frames:8,loop:!0,spriteSheet:"./img/Ship_Damage.png",ticksPerFrame:1}}})}),new y.default({GameState:this.GameState,name:"Player 2",uuid:(0,m.default)(),color:"255,0,0",avatar:new o.default({GameState:this.GameState,dimensions:new b.default(64,128),scale:new b.default(this.GameState.Canvas.width/460,this.GameState.Canvas.width/460),offset:new b.default(.5,.5),callback:this.clickAvatar.bind(this,"Player 2"),mouseDownSprite:"./img/Ship.png",mouseUpSprite:"./img/Ship.png",targetPosition:new b.default(this.GameState.Canvas.width+256,this.GameState.Canvas.cy),mirrorX:!0,animations:{mouseDown:{frames:12,loop:!0,spriteSheet:"./img/Ship.png",ticksPerFrame:5},mouseUp:{frames:12,loop:!0,spriteSheet:"./img/Ship.png",ticksPerFrame:5},damage:{frames:8,loop:!0,spriteSheet:"./img/Ship_Damage.png",ticksPerFrame:1}}})})],this.attackingPlayer=this.players[0],this.defendingPlayer=this.players[1],this.players.forEach(function(e,t){for(var n=new h.default({GameState:a.GameState,position:new b.default(0,-a.GameState.Canvas.cy)}),i=0;i<e.handSize-t;i++)n.add(a.deck.draw());n.setVisibility(!1),t===a.currentPlayerTurn&&n.setVisibility(!0),e.hand=n,a.GameState.Scene.add(n)}),this.grid=new c.default({GameState:this.GameState,rows:this.rows,columns:this.columns,minimumPadding:100,players:this.players}),this.grid.init(),this.currentAction=new r.default({player:this.attackingPlayer});for(var t=0;t<5;t++){var n=new u.default({GameState:this.GameState,dimensions:new b.default(32,32),offset:new b.default(.5,.5),scale:new b.default(6+Math.floor(14*Math.random()),6+Math.floor(14*Math.random()))});n.canvasPosition=new b.default(Math.random()*this.GameState.Canvas.width,Math.random()*this.GameState.Canvas.height),this.GameState.Scene.add(n)}this.addControlsCallback("mouseDown",this.handleMouseDown.bind(this)),this.addControlsCallback("mouseUp",this.handleMouseUp.bind(this)),this.addControlsCallback("mouseMove",this.handleMouseMove.bind(this)),this.addControlsCallback("touchStart",this.handleMouseDown.bind(this)),this.addControlsCallback("touchEnd",this.handleMouseUp.bind(this)),this.addControlsCallback("touchMove",this.handleMouseMove.bind(this))}},{key:"handleMouseDown",value:function(e){var t=this.findTileAtPosition(this.GameState.Controls.position);t&&(this.currentAction.sourceTile=t).isInHand&&this.tileHelper.initDrag(t,this.currentAction,this.cycleActions.bind(this))}},{key:"handleMouseMove",value:function(e){this.tileHelper.isDragging&&this.tileHelper.tile&&(this.tileHelper.tile.canvasPosition=this.GameState.Controls.position,this.resetHover(),this.setHover(this.GameState.Controls.position))}},{key:"handleMouseUp",value:function(e){var t=this.findTileAtPosition(this.GameState.Controls.position);if(this.resetHover(),!t||"EMPTY"===t.tileType.type&&!this.tileHelper.isDragging)return this.currentAction.sourceTile=null,this.currentAction.targetTile=null,void this.tileHelper.clear();"EMPTY"===(this.currentAction.targetTile=t).tileType.type&&this.currentAction.sourceTile&&this.currentAction.sourceTile.isInHand&&(this.tileHelper.placeDraggedCell(),this.tileHelper.clear()),"PLAYER_COLUMN"!==t.tileType.type&&"EMPTY"!==t.tileType.type&&this.currentAction.sourceTile&&this.currentAction.sourceTile.uuid===t.uuid&&this.tileHelper.initRotation(t,this.currentAction,this.cycleActions.bind(this))}},{key:"clickAvatar",value:function(e){if(!this.attackingPlayer.name!==e){var t=this.getTileWithPlayerName(e);this.currentAction.sourceTile=t,this.tileHelper.initMove(t,this.currentAction,this.cycleActions.bind(this))}}},{key:"resetHover",value:function(){this.grid.tiles.forEach(function(e){return e.isHovered=!1})}},{key:"setHover",value:function(e){var t=this.findTileAtPosition(e);t&&(t.isHovered=!0)}},{key:"findTileAtPosition",value:function(e){var t=this.grid.getCellAtCanvasPosition(e);return t||(t=this.attackingPlayer.hand.getCellAtCanvasPosition(e)),t}},{key:"cycleActions",value:function(){this.processConnection(),this.attackingPlayer.actions-=1,this.attackingPlayer.actions<=0&&(this.attackingPlayer.actions=this.attackingPlayer.maxActions,this.cyclePlayerTurn()),this.currentAction=new r.default({player:this.attackingPlayer}),this.GameState.UI.updatePlayerStats(this.players)}},{key:"cyclePlayerTurn",value:function(){this.defendingPlayer=this.players[this.currentPlayerTurn],this.defendingPlayer.hand.setVisibility(!1),this.currentPlayerTurn++,this.currentPlayerTurn>=this.players.length&&(this.currentPlayerTurn=0),this.attackingPlayer=this.players[this.currentPlayerTurn],this.attackingPlayer.hand.setVisibility(!0),0<this.deck.tiles.length&&this.attackingPlayer.hand.add(this.deck.draw())}},{key:"getTileWithPlayerName",value:function(t){return this.grid.tiles.find(function(e){return e.player&&e.player.name===t})}},{key:"processConnection",value:function(){var e=new v.default(this.grid.tiles),t=this.getTileWithPlayerName(this.attackingPlayer.name),n=this.getTileWithPlayerName(this.defendingPlayer.name),i=e.findPath(t,n);if(0<i.length){var a=0;i.forEach(function(e){e.placedBy.name===t.player.name&&(a+=1)}),n.player.health-=t.player.damage+a,n.player.avatar.takeDamageAnimation(),this.fireLightning(i)}this.endGameLogic()}},{key:"fireLightning",value:function(e){var t=this,n=new d.default({GameState:this.GameState,path:e});window.setTimeout(function(){return t.GameState.Scene.remove(n.uuid)},750)}},{key:"endGameLogic",value:function(){var e=this,t=!1;this.players.forEach(function(e){e.health<=0&&(t=!0,e.health=0)}),t&&window.setTimeout(function(){e.winner=e.players.find(function(e){return 0<e.health}),e.GameState.isPaused=!0,e.GameState.UI.updateScoreScreen(),e.GameState.UI.setScreen("score")},1500)}}]),i}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=n(5),c=(i=r)&&i.__esModule?i:{default:i};var o=function(){function l(e){var t=e.type,n=void 0===t?new c.default("ROTATE"):t,i=e.targetTile,a=void 0===i?null:i,r=e.sourceTile,o=void 0===r?null:r,s=e.player,u=void 0===s?null:s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.actionType=n,this.targetTile=a,this.sourceTile=o,this.player=u,this.rotationDirection=1}return a(l,[{key:"rotate",value:function(){this.targetTile.rotateCell(this.rotationDirection),this.targetTile.placedBy=this.player}},{key:"place",value:function(){this.targetTile.setType(this.sourceTile.tileType),this.targetTile.targetRotation=this.sourceTile.targetRotation,this.targetTile.rotation=this.sourceTile.rotation,this.targetTile.neighborPattern=this.sourceTile.neighborPattern,this.targetTile.neighbors=this.targetTile.getNeighbors(),this.targetTile.placedBy=this.player,this.player.hand.remove(this.sourceTile.uuid)}},{key:"move",value:function(){this.targetTile.player=this.sourceTile.player,this.sourceTile.player=null,this.targetTile.player.setAvatarPosition(this.targetTile)}},{key:"commit",value:function(){switch(this.actionType.type){case"MOVE":this.move();break;case"PLACE":this.place();break;case"ROTATE":this.rotate()}}}]),l}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=a(n(11));a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(e){function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e)),n=(e.sprite,e.targetPosition),i=void 0===n?null:n;return t.targetPosition=i,t.canvasPosition=i,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,r.default),i(a,[{key:"draw",value:function(){this.handleTurbulence(),function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(i):void 0}(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"draw",this).call(this)}},{key:"takeDamageAnimation",value:function(e){var t=this;this.currentAnimation="damage",window.setTimeout(function(){t.currentAnimation="mouseUp"},750)}}]),a}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(0),r=(i=a)&&i.__esModule?i:{default:i};t.default=function(e,t){return new r.default(t.x+e.Canvas.width/2,e.Canvas.height-(t.y+e.Canvas.height/2))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=r(n(2));r(n(0));function r(e){return e&&e.__esModule?e:{default:e}}var o=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),e.animations={exist:{frames:1,loop:!1,spriteSheet:"./img/sky.png",ticksPerFrame:10}},e.currentAnimation="exist";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.moveSpeed=2,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,a.default),i(n,[{key:"draw",value:function(){this.handleMovement(),function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(i):void 0}(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"draw",this).call(this)}},{key:"handleMovement",value:function(){var e=this.canvasPosition.y+this.moveSpeed*this.GameState.deltaTime;0<=e&&(e=-this.GameState.Canvas.height),this.canvasPosition.y=e}}]),n}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=a(n(2)),o=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),e.animations={exist:{frames:1,loop:!1,spriteSheet:"./img/cloud_1.png",ticksPerFrame:10}},e.currentAnimation="exist";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e)),n=(e.sprite,e.targetPosition),i=void 0===n?null:n;return t.targetPosition=i,t.canvasPosition=i,t.moveSpeed=5+Math.floor(5*Math.random()),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,r.default),i(a,[{key:"handleMovement",value:function(){var e=this.canvasPosition.y+this.moveSpeed*this.GameState.deltaTime;e>=2*this.GameState.Canvas.height?this.canvasPosition=new o.default(Math.random()*this.GameState.Canvas.width,-this.GameState.Canvas.cy):this.canvasPosition.y=e}},{key:"drawEntity",value:function(){this.handleMovement(),function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(i):void 0}(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"drawEntity",this).call(this)}},{key:"takeDamageAnimation",value:function(){var e=this;this.currentAnimation="damage",window.setTimeout(function(){e.currentAnimation="mouseUp"},750)}}]),a}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=n(7),o=(i=a)&&i.__esModule?i:{default:i};var s=function(){function a(e){var t=e.deckSize,n=void 0===t?30:t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.tiles=[],this.tilesPerType=Math.floor(n/4),this.typeCounter=0,this.currentType=0,this.allowedTypes=["STRAIGHT","BEND","TRIPLE","QUAD"];for(var i=0;i<n;i++)this.tiles.push(new o.default(this.allowedTypes[this.currentType])),this.incrementType();this.shuffle()}return r(a,[{key:"incrementType",value:function(){this.typeCounter++,this.typeCounter>=this.tilesPerType&&(this.typeCounter=0,this.currentType+=1,this.currentType>=this.allowedTypes.length&&(this.currentType=0))}},{key:"shuffle",value:function(){for(var e=this.tiles.length-1;0<e;e--){var t=Math.floor(Math.random()*(e+1)),n=[this.tiles[t],this.tiles[e]];this.tiles[e]=n[0],this.tiles[t]=n[1]}}},{key:"draw",value:function(){return this.tiles.pop()}}]),a}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=l(n(12)),a=l(n(4)),o=l(n(31)),s=l(n(7)),u=l(n(0));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var t=e.GameState,n=e.rows,i=void 0===n?6:n,a=e.columns,r=void 0===a?6:a,o=e.minimumPadding,s=void 0===o?50:o,u=e.players;this.GameState=t,this.rows=i,this.columns=r+2,this.maxRowsOrColumns=Math.max(this.rows,this.columns),this.minimumPadding=s,this.tiles=[],this.players=u}return i(l,[{key:"init",value:function(){var t=this;this.minDimension=Math.min(this.GameState.Canvas.width,this.GameState.Canvas.height),this.cellSize=(this.minDimension-this.minimumPadding)/this.maxRowsOrColumns,this.padding=new u.default((this.GameState.Canvas.width-this.cellSize*this.columns)/2,(this.GameState.Canvas.height-this.cellSize*this.rows)/2);for(var e=0;e<this.rows;e++)for(var n=0;n<this.columns;n++){var i=new s.default("EMPTY");0!==n&&n!==this.columns-1||(i=new s.default("PLAYER_COLUMN")),this.addCell(n,e,i)}this.tiles.forEach(function(e){e.init(t.tiles)}),this.positionAvatars()}},{key:"positionAvatars",value:function(){var a=this;this.players.forEach(function(e,t){var n=(0===t?0:a.columns-1)+"_"+Math.floor((0,r.default)(0,a.rows-1)),i=a.tiles.find(function(e){return e.id===n});(i.player=e).setAvatarPosition(i),a.GameState.Scene.add(e.avatar)})}},{key:"addCell",value:function(e,t,n){var i=new a.default({GameState:this.GameState,dimensions:new u.default(64,64),offset:new u.default(.5,.5),scale:new u.default(this.cellSize/64,this.cellSize/64),id:e+"_"+t,x:e,y:t,type:n,outline:new o.default({GameState:this.GameState})});i.canvasPosition=new u.default(e*this.cellSize+this.padding.x+this.cellSize/2,t*this.cellSize+this.padding.y+this.cellSize/2),i.targetPosition=i.canvasPosition,i.outline.canvasPosition=i.targetPosition,i.outline.scale=i.scale,i.outline.dimensions=i.dimensions,this.GameState.Scene.add(i),this.tiles.push(i)}},{key:"getCellAtCanvasPosition",value:function(e){var t=Math.floor((e.x-this.padding.x)/this.cellSize),n=Math.floor((e.y-this.padding.y)/this.cellSize);return this.tiles.find(function(e){return e.id===t+"_"+n})}}]),l}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=a(n(3)),o=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e)),n=e.scale,i=void 0===n?new o.default(1,1):n;return t.scale=i,t.calculateOffset(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,r.default),i(a,[{key:"draw",value:function(){this.GameState.Canvas.ctx.beginPath(),this.GameState.Canvas.ctx.lineWidth=1*window.devicePixelRatio,this.GameState.Canvas.ctx.rect(0,0,this.dimensions.x*this.scale.x,this.dimensions.y*this.scale.y),this.GameState.Canvas.ctx.stroke()}},{key:"calculateOffset",value:function(){this.scale&&(this.absoluteOffset=new o.default(-this.offset.x*this.dimensions.x*this.scale.x,-this.offset.y*this.dimensions.y*this.scale.y))}}]),a}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=l(n(3)),r=l(n(6)),o=l(n(4)),s=l(n(1)),u=l(n(0));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.tiles=[],t.selectedTile=0,t.size=64,t.scale=2,t.paddingRatio=.2,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,a.default),i(n,[{key:"add",value:function(e){var t=new o.default({GameState:this.GameState,dimensions:new u.default(this.size,this.size),offset:new u.default(.5,.5),scale:new u.default(this.scale,this.scale),type:e,isVisible:!1,isInHand:!0});t.uuid=(0,s.default)(),this.tiles.push(t),this.updatePosition()}},{key:"remove",value:function(t){this.tiles=this.tiles.filter(function(e){return e.uuid!==t}),this.updatePosition()}},{key:"updatePosition",value:function(){var n=this,i=this.tiles.length*this.size*this.scale/2;this.tiles.forEach(function(e,t){e.canvasPosition=new u.default(n.GameState.Canvas.cx+t*n.size*(n.scale+n.paddingRatio)-i,n.GameState.Canvas.height-n.size*n.scale/2)})}},{key:"load",value:function(){this.tiles.forEach(function(e){e.load()})}},{key:"drawEntity",value:function(){this.tiles.forEach(function(e){e.drawEntity()})}},{key:"setVisibility",value:function(t){this.tiles.forEach(function(e){e.isVisible=t})}},{key:"getCellAtCanvasPosition",value:function(t){return this.tiles.find(function(e){return(0,r.default)(t,new u.default(e.canvasPosition.x+e.absoluteOffset.x,e.canvasPosition.y+e.absoluteOffset.y),new u.default(e.dimensions.x*e.scale.x,e.dimensions.y*e.scale.y))})}}]),n}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=r(n(3)),s=(r(n(6)),r(n(4)),r(n(1)),r(n(0)));function r(e){return e&&e.__esModule?e:{default:e}}var o=function(e){function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e)),n=e.GameState,i=e.path,a=e.color,r=void 0===a?"142,205,255":a;return t.GameState=n,t.path=i,t.color=r,t.elements=[],t.offshoots=20,t.maxwidth=15,t.ofshootBranchLength=40,t.GameState.Scene.add(t),t.createElements(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,a.default),i(o,[{key:"createElements",value:function(){this.elements=[];for(var e=0;e<this.path.length;e++){if(!this.path[e].cameFrom)return;this.elements[e]={from:this.path[e].cameFrom.canvasPosition,to:this.path[e].canvasPosition,index:Math.floor(3*Math.random()),children:[]};for(var t=this.path[e].canvasPosition,n=0;n<this.offshoots;n++){var i=.5<Math.random()?1:-1,a=.5<Math.random()?1:-1,r=new s.default(t.x+Math.random()*this.ofshootBranchLength*i,t.y+Math.random()*this.ofshootBranchLength*a);this.elements[e].children.push({from:t,to:r,index:n}),t=r}}}},{key:"drawEntity",value:function(){var t=this;this.createElements(),this.elements.forEach(function(e){t.drawLine(e.from,e.to,e.index),e.children.forEach(function(e){return t.drawLine(e.from,e.to,e.index)})})}},{key:"drawLine",value:function(e,t,n){this.GameState.Canvas.ctx.beginPath(),this.GameState.Canvas.ctx.strokeStyle="rgba("+this.color+", 0.65)",this.GameState.Canvas.ctx.lineWidth=Math.max(1,this.maxwidth-n),this.GameState.Canvas.ctx.moveTo(e.x,e.y),this.GameState.Canvas.ctx.lineTo(t.x,t.y),this.GameState.Canvas.ctx.stroke(),this.GameState.Canvas.ctx.beginPath(),this.GameState.Canvas.ctx.strokeStyle="rgba(255,255,255, 0.65)",this.GameState.Canvas.ctx.lineWidth=this.GameState.Canvas.ctx.lineWidth/3,this.GameState.Canvas.ctx.moveTo(e.x,e.y),this.GameState.Canvas.ctx.lineTo(t.x,t.y),this.GameState.Canvas.ctx.stroke()}}]),o}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=n(35),o=(i=r)&&i.__esModule?i:{default:i};var s=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.grid=e,this.startCell=null,this.endCell=null,this.frontier=new o.default,this.pathFound=!1,this.hasSearched={}}return a(t,[{key:"findPath",value:function(e,t){this.startCell=e,this.endCell=t,this.hasSearched[e.id]=!0,this.frontier.enqueue(e,1);for(var n=0;!this.pathFound&&0<this.frontier.items.length&&!(100<++n);)for(var i=0;i<this.frontier.items.length;i++)this.getFrontier();return this.buildPath()}},{key:"isPassable",value:function(e){return("PLAYER_COLUMN"!==e.tileType.type||e.player)&&"EMPTY"!==e.tileType.type}},{key:"isConnected",value:function(t,e){return e.neighbors.find(function(e){return!!e&&e.uuid===t.uuid})}},{key:"getFrontier",value:function(){var t=this,n=this.frontier.dequeue();n.neighbors.forEach(function(e){e&&(e.uuid===t.endCell.uuid&&(t.pathFound=!0),!t.hasSearched[e.id]&&t.isPassable(e)&&t.isConnected(n,e)&&(t.hasSearched[e.id]=!0,e.cameFrom=n,t.frontier.enqueue(e,1)))})}},{key:"buildPath",value:function(){for(var e=[this.endCell],t=0,n=!1;!1===n&&!(100<++t);){var i=e[e.length-1].cameFrom;if(!i)break;this.startCell.uuid===i.uuid&&(n=!0),e.push(i)}return this.pathFound?e:[]}}]),t}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=[]}return i(e,[{key:"enqueue",value:function(e,t){for(var n=!1,i=0;i<this.items.length;i++)if(this.items[i].priority>e.priority){this.items.splice(i,0,e),n=!0;break}n||this.items.push(e)}},{key:"dequeue",value:function(){if(0!=this.items.length)return this.items.shift()}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=n(0),o=(i=r)&&i.__esModule?i:{default:i};var s=function(){function k(e){var t=e.GameState,n=e.actions,i=void 0===n?2:n,a=e.avatar,r=e.color,o=void 0===r?"blue":r,s=e.controller,u=void 0===s?"human":s,l=e.damage,c=void 0===l?2:l,h=e.hand,f=void 0===h?[]:h,d=e.handSize,v=void 0===d?4:d,y=e.health,p=void 0===y?50:y,m=e.maxActions,b=void 0===m?2:m,g=e.maxHealth,w=void 0===g?50:g,S=e.name,P=void 0===S?"Player 1":S;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,k),this.GameState=t,this.actions=i,this.avatar=a,this.color=o,this.controller=u,this.damage=c,this.hand=f,this.handSize=v,this.health=p,this.maxActions=b,this.maxHealth=w,this.name=P}return a(k,[{key:"setAvatarPosition",value:function(e){var t="Player 1"===this.name?-1:1;this.avatar.targetPosition=new o.default(e.canvasPosition.x+e.dimensions.x*e.scale.x/2*t,e.canvasPosition.y)}}]),k}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),a=u(n(5)),r=u(n(38)),o=u(n(11)),s=u(n(0));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.helperUUIDs=[],this.tile=null,this.currentAction=null,this.callback=function(){},this.isRotating=!1,this.isDragging=!1,this.isMoving=!1}return i(t,[{key:"initRotation",value:function(e,t,n){this.clear(),this.tile=e,this.currentAction=t,this.callback=n,this.isRotating=!0;var i=new o.default({callback:this.rotateLeft.bind(this),mouseDownSprite:"./img/rotate.png",mouseUpSprite:"./img/rotate.png",scale:e.scale,dimensions:new s.default(64,64),mirrorX:!0,order:-20});i.canvasPosition=new s.default(e.canvasPosition.x-e.dimensions.x*e.scale.x,e.canvasPosition.y),i.calculateOffset();var a=new o.default({callback:this.rotateRight.bind(this),mouseDownSprite:"./img/rotate.png",mouseUpSprite:"./img/rotate.png",scale:e.scale,dimensions:new s.default(64,64),order:-20});a.canvasPosition=new s.default(e.canvasPosition.x+e.dimensions.x*e.scale.x,e.canvasPosition.y),a.calculateOffset(),this.helperUUIDs=[this.GameState.Scene.add(i),this.GameState.Scene.add(a)]}},{key:"rotateLeft",value:function(){this.currentAction.actionType=new a.default("ROTATE"),this.currentAction.rotationDirection=1,this.currentAction.targetTile=this.tile,this.currentAction.commit(),this.tile.isInHand||(this.callback(),this.clear())}},{key:"rotateRight",value:function(){this.currentAction.actionType=new a.default("ROTATE"),this.currentAction.rotationDirection=-1,this.currentAction.targetTile=this.tile,this.currentAction.commit(),this.tile.isInHand||(this.callback(),this.clear())}},{key:"initDrag",value:function(e,t,n){this.clear(),this.currentAction=t,this.callback=n,this.isDragging=!0;var i=(0,r.default)(e);i.alpha=.75,this.helperUUIDs=[this.GameState.Scene.add(i)],this.tile=i}},{key:"placeDraggedCell",value:function(){this.currentAction.actionType=new a.default("PLACE"),this.currentAction.commit(),this.callback()}},{key:"initMove",value:function(e,t,n){this.clear(),this.tile=e,this.currentAction=t,this.callback=n,this.isMoving=!0;var i=this.currentAction.sourceTile.player.avatar,a=new o.default({callback:this.moveUp.bind(this),mouseDownSprite:"./img/move.png",mouseUpSprite:"./img/move.png",scale:e.scale,dimensions:new s.default(64,64),order:-20});a.canvasPosition=new s.default(i.canvasPosition.x,i.canvasPosition.y-i.dimensions.y*i.scale.y/2),a.calculateOffset();var r=new o.default({callback:this.moveDown.bind(this),mouseDownSprite:"./img/move.png",mouseUpSprite:"./img/move.png",scale:e.scale,dimensions:new s.default(64,64),mirrorY:!0,order:-20});r.canvasPosition=new s.default(i.canvasPosition.x,i.canvasPosition.y+i.dimensions.y*i.scale.y/2),r.calculateOffset(),this.helperUUIDs=[this.GameState.Scene.add(a),this.GameState.Scene.add(r)]}},{key:"moveUp",value:function(){var t=this;this.currentAction.actionType=new a.default("MOVE");var e=this.GameState.currentLevel.grid.tiles.find(function(e){return e.id===t.tile.x+"_"+(t.tile.y-1)});e&&(this.currentAction.targetTile=e,this.currentAction.commit(),this.callback()),this.clear()}},{key:"moveDown",value:function(){var t=this;this.currentAction.actionType=new a.default("MOVE");var e=this.GameState.currentLevel.grid.tiles.find(function(e){return e.id===t.tile.x+"_"+(t.tile.y+1)});e&&(this.currentAction.targetTile=e,this.currentAction.commit(),this.callback()),this.clear()}},{key:"clear",value:function(){var t=this;this.helperUUIDs.forEach(function(e){return t.GameState.Scene.remove(e)}),this.helperUUIDs=[],this.tile=null,this.currentAction=null,this.callback=function(){},this.isRotating=!1,this.isDragging=!1,this.isMoving=!1}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.isRunning=!1}return i(t,[{key:"init",value:function(){this.isRunning||(this.isRunning=!0,this.render())}},{key:"shouldRender",value:function(){return!this.GameState.isPaused}},{key:"render",value:function(){this.isRunning&&window.requestAnimationFrame(this.render.bind(this)),this.shouldRender()&&(this.GameState.Canvas.clear(),this.GameState.Scene.gameObjects.forEach(function(e){return e.drawEntity()}))}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),r=n(1),o=(i=r)&&i.__esModule?i:{default:i};var s=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.gameObjects=[]}return a(t,[{key:"init",value:function(){}},{key:"add",value:function(e){return e.uuid=(0,o.default)(),e.load(),this.gameObjects.push(e),e.uuid}},{key:"remove",value:function(t){this.gameObjects.find(function(e){return e.uuid===t}).unload(),this.gameObjects=this.gameObjects.filter(function(e){return e.uuid!==t})}},{key:"clear",value:function(){this.gameObjects=[]}}]),t}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.screens=document.querySelectorAll("[data-screen]"),this.buttons={fullscreen:document.querySelectorAll("[data-gamestate-fullscreen]"),initAudio:document.querySelectorAll("[data-gamestate-init-audio]"),level:document.querySelectorAll("[data-gamestate-change-level]"),mute:document.querySelectorAll("[data-gamestate-mute]"),pause:document.querySelectorAll("[data-gamestate-pause]"),play:document.querySelectorAll("[data-gamestate-play]"),quit:document.querySelectorAll("[data-gamestate-quit]"),restart:document.querySelectorAll("[data-gamestate-restart]"),screens:document.querySelectorAll("[data-ui-target-screen]")},this.isFullscreen=!1}return i(t,[{key:"init",value:function(){this.initListenters(),this.setScreen("mainmenu"),this.updateLevel(this.GameState.levels[this.GameState.level].name)}},{key:"initListenters",value:function(){var t=this;Array.from(this.buttons.initAudio).forEach(function(e){e.addEventListener("click",function(){t.GameState.Audio.isInitialized||t.GameState.Audio.init()})}),Array.from(this.buttons.play).forEach(function(e){e.addEventListener("click",function(){return t.GameState.play()})}),Array.from(this.buttons.pause).forEach(function(e){e.addEventListener("click",function(){return t.GameState.togglePause()})}),Array.from(this.buttons.restart).forEach(function(e){e.addEventListener("click",function(){return t.GameState.restart()})}),Array.from(this.buttons.fullscreen).forEach(function(e){e.addEventListener("click",function(){return t.toggleFullscreen()})}),Array.from(this.buttons.level).forEach(function(e){e.addEventListener("click",function(e){t.GameState.level+=parseInt(e.target.dataset.gamestateChangeLevel,10),t.GameState.level>=t.GameState.levels.length&&(t.GameState.level=0),t.GameState.level<0&&(t.GameState.level=t.GameState.levels.length-1),t.updateLevel(t.GameState.levels[t.GameState.level].name)})}),Array.from(this.buttons.quit).forEach(function(e){e.addEventListener("click",function(){return t.GameState.quit()})}),Array.from(this.buttons.mute).forEach(function(e){e.addEventListener("click",function(e){return t.GameState.Audio.toggleMute()})}),Array.from(this.buttons.screens).forEach(function(e){e.addEventListener("click",t.initTransitions.bind(t))})}},{key:"initTransitions",value:function(e){this.setScreen(e.target.dataset.uiTargetScreen)}},{key:"setScreen",value:function(t){Array.from(this.screens).forEach(function(e){e.dataset.screen===t?e.classList.add("active"):e.classList.remove("active")})}},{key:"toggleFullscreen",value:function(){var e=document.documentElement;this.isFullscreen||(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()),this.isFullscreen&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()),this.isFullscreen=!this.isFullscreen}},{key:"updatePlayerStats",value:function(e){var o=this;e&&e.forEach(function(e,t){var n=document.querySelector('[data-ui-player="'+(t+1)+'"] [data-ui="name"]'),i=document.querySelector('[data-ui-player="'+(t+1)+'"] [data-ui="health"]'),a=document.querySelector('[data-ui-player="'+(t+1)+'"] [data-ui="damage"]'),r=document.querySelector('[data-ui-player="'+(t+1)+'"] [data-ui="actions"]');n.innerHTML=e.name+(o.GameState.currentLevel.currentPlayerTurn===t?"*":""),i.innerHTML="HP: "+e.health+"/"+e.maxHealth,a.innerHTML="DMG: "+e.damage,r.innerHTML="ACT: "+e.actions+"/"+e.maxActions})}},{key:"updateLevel",value:function(t){t&&Array.from(document.querySelectorAll('[data-ui="level"]')).forEach(function(e){e.innerHTML=t})}},{key:"updateScoreScreen",value:function(){this.GameState.currentLevel.winner&&(document.querySelector('[data-ui="winner"]').innerHTML=this.GameState.currentLevel.winner.name+" Wins!")}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();var a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.GameState=e,this.isRunning=!1,this.lastUpdate=Date.now(),this.updateRate=10}return i(t,[{key:"init",value:function(){this.isRunning||(this.isRunning=!0,this.update())}},{key:"calculateDeltaTime",value:function(){var e=Date.now();this.GameState.deltaTime=e-this.lastUpdate,this.lastUpdate=e}},{key:"shouldUpdate",value:function(){return!this.GameState.isPaused}},{key:"update",value:function(){this.isRunning&&window.setTimeout(this.update.bind(this),this.updateRate),this.shouldUpdate()&&(this.calculateDeltaTime(),this.GameState.levels[this.GameState.level].gameLogic(),this.GameState.Scene.gameObjects.forEach(function(e){return e.update()}))}}]),t}();t.default=a}])});